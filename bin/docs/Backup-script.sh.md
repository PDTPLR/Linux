## –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
```bash
#!/bin/bash

# ==================== –ù–ê–°–¢–†–û–ô–ö–ò ====================
export BORG_REPO="/home/pdtplr/backups/borg-repo"      # –ü—É—Ç—å –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é Borg
export BORG_PASSPHRASE="your_strong_password_here"     # –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
EXCLUDE_FROM="/home/pdtplr/.borg-exclude"              # –§–∞–π–ª –∏—Å–∫–ª—é—á–µ–Ω–∏–π
LOG_FILE="/home/pdtplr/backups/borg-backup.log"        # –§–∞–π–ª –ª–æ–≥–∞
LOCK_FILE="/tmp/borg_backup.lock"                      # –§–∞–π–ª –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
MAX_ATTEMPTS=3                                         # –ú–∞–∫—Å. –ø–æ–ø—ã—Ç–æ–∫
ATTEMPT_DELAY=300                                      # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏ (5 –º–∏–Ω)
RETENTION_POLICY="--keep-daily 7 --keep-weekly 4 --keep-monthly 6" # –ü–æ–ª–∏—Ç–∏–∫–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

# ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
mkdir -p "$(dirname "$BORG_REPO")" "$(dirname "$LOG_FILE")"
touch "$LOG_FILE" "$EXCLUDE_FROM"

# ==================== –§–£–ù–ö–¶–ò–ò ====================
notify() {
    export DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/$(id -u)/bus
    local urgency=$1
    local message=$2
    notify-send -u "$urgency" -t 10000 "Borg Backup" "$message"
    echo "$(date '+%Y-%m-%d %H:%M:%S') - $message" >> "$LOG_FILE"
}

acquire_lock() {
    exec 9>"$LOCK_FILE"
    flock -n 9 || return 1
}

check_dependencies() {
    for cmd in borg notify-send; do
        if ! command -v $cmd &>/dev/null; then
            notify "critical" "–û—à–∏–±–∫–∞: –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω $cmd"
            exit 1
        fi
    done
}

init_repo() {
    if [ ! -d "$BORG_REPO" ]; then
        if ! borg init --encryption=repokey-blake2 "$BORG_REPO" >> "$LOG_FILE" 2>&1; then
            notify "critical" "–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è"
            exit 2
        fi
    fi
}

# ==================== –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê ====================
main() {
    check_dependencies
    init_repo

    for ((i=1; i<=MAX_ATTEMPTS; i++)); do
        if acquire_lock; then
            borg break-lock "$BORG_REPO" >> "$LOG_FILE" 2>&1
            backup_name="eva-$(date +%Y-%m-%d_%H-%M-%S)"
            
            notify "normal" "üîÑ –ü–æ–ø—ã—Ç–∫–∞ $i/$MAX_ATTEMPTS: –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞..."
            
            # –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞
            if borg create --stats \
                --compression zstd \
                --exclude-from "$EXCLUDE_FROM" \
                "$BORG_REPO::$backup_name" \
                /home/pdtplr \
                >> "$LOG_FILE" 2>&1
            then
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
                if borg check "$BORG_REPO" >> "$LOG_FILE" 2>&1; then
                    notify "normal" "‚úÖ –ë—ç–∫–∞–ø $backup_name —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω!"
                    
                    # –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤
                    if borg prune --stats $RETENTION_POLICY "$BORG_REPO" >> "$LOG_FILE" 2>&1; then
                        notify "normal" "üßπ –°—Ç–∞—Ä—ã–µ –±—ç–∫–∞–ø—ã –æ—á–∏—â–µ–Ω—ã"
                    else
                        notify "critical" "‚ö†Ô∏è –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –±—ç–∫–∞–ø–æ–≤!"
                    fi
                    
                    rm -f "$LOCK_FILE"
                    exit 0
                else
                    notify "critical" "‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±—ç–∫–∞–ø–∞!"
                fi
            else
                notify "critical" "‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –±—ç–∫–∞–ø–∞! –ü–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ ${ATTEMPT_DELAY} —Å–µ–∫..."
                sleep $ATTEMPT_DELAY
            fi
        else
            notify "low" "‚è≥ –ü—Ä–æ—Ü–µ—Å—Å —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è. –û–∂–∏–¥–∞–Ω–∏–µ..."
            sleep 60
        fi
    done
    
    notify "critical" "üî• –í—Å–µ –ø–æ–ø—ã—Ç–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –±—ç–∫–∞–ø–∞ –ø—Ä–æ–≤–∞–ª–∏–ª–∏—Å—å!"
    exit 1
}

# ==================== –ó–ê–ü–£–°–ö ====================
main "$@"
```

---

### üîç –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞:

#### 1. –£–ª—É—á—à–µ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `repokey-blake2` –¥–ª—è –∑–∞—â–∏—Ç—ã –¥–∞–Ω–Ω—ã—Ö
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**: –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —É—Ç–∏–ª–∏—Ç
- **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ

#### 2. –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—ç–∫–∞–ø–∞–º–∏
- **–ü–æ–ª–∏—Ç–∏–∫–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è**: 
  - –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –±—ç–∫–∞–ø—ã –∑–∞ 7 –¥–Ω–µ–π
  - –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –∑–∞ 4 –Ω–µ–¥–µ–ª–∏
  - –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –∑–∞ 6 –º–µ—Å—è—Ü–µ–≤
- **–°–∂–∞—Ç–∏–µ zstd**: –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç—å/—Å—Ç–µ–ø–µ–Ω—å —Å–∂–∞—Ç–∏—è
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏**: –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è `borg check`

#### 3. –£–ª—É—á—à–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –†–∞–∑–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –≤–∞–∂–Ω–æ—Å—Ç–∏ (normal/low/critical)
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –í–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å—Ç–∞—Ç—É—Å–∞ (—ç–º–æ–¥–∑–∏)

#### 4. –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –ú–µ–∂–ø—Ä–æ—Ü–µ—Å—Å–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —á–µ—Ä–µ–∑ `flock`
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ Borg

#### 5. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è Arch Linux
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
sudo pacman -S borg python-notify2 zstd
```

2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –≤ `~/.borg-exclude`:
```
/home/*/.cache/
/home/*/.thumbnails
/var/tmp/*
```

3. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ —Å–µ—Ä–≤–∏—Å:
```bash
systemctl --user enable borg-backup.timer
```

4. –ü—Ä–æ—Å–º–æ—Ç—Ä –±—ç–∫–∞–ø–æ–≤:
```bash
borg list /home/pdtplr/backups/borg-repo
```

---

### üöÄ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã:
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ** –ø—Ä–∏ —Å–±–æ—è—Ö
- **–ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏** –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º
- **–ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞** —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –Ω–∞—á–∞–ª–µ —Å–∫—Ä–∏–ø—Ç–∞
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ** –∑–∞ —Å—á—ë—Ç —Å–∂–∞—Ç–∏—è –∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏

–°–∫—Ä–∏–ø—Ç –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö –∏ —É–¥–æ–±–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –∏—Å—Ç–æ—Ä–∏–µ–π –±—ç–∫–∞–ø–æ–≤.